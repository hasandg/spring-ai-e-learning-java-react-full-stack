# AI Service

## Spring AI 1.0.0-M6 Integration

This service has been updated to use Spring AI 1.0.0-M6, which provides an improved API for interacting with AI models. The key changes include:

- Updated dependency in `pom.xml` to use `spring-ai-openai-spring-boot-starter:1.0.0-M6`
- Added Spring Milestone repository to resolve the M6 release artifacts
- Updated the OpenAI provider to use the new fluent API
- Simplified the code by using the ChatClient.Builder pattern

The new API makes it easier to create prompts with system and user messages, and the response handling is more straightforward.

## Environment Variables

The service uses environment variables for sensitive information like API keys. There are two ways to provide these variables:

1. **Using a .env file** (recommended for development):
   - Create a `.env` file in the root directory of the AI service
   - Add your API keys in the following format:
     ```
     POE_API_KEY=your-poe-api-key-here
     OPENAI_API_KEY=your-openai-api-key-here
     ```
   - The service will automatically load these variables on startup

2. **Using system environment variables** (recommended for production):
   - Set the environment variables in your system or deployment environment
   - No additional configuration is needed

Note: The `.env` file is included in `.gitignore` to prevent committing sensitive information.

## Features

- Question answering through OpenAI, Poe, or a mock provider
- Context-aware responses based on course information
- Configurable AI providers

## Configuration

The AI service can be configured in the `application.properties` file:

```properties
# AI Provider Configuration
# Options: openai, poe, mock
ai.provider=openai
# ai.provider=poe
# ai.provider=mock

# Spring AI OpenAI Configuration
spring.ai.openai.api-key=${OPENAI_API_KEY:dummy-key-for-dev}
spring.ai.openai.chat.model=gpt-3.5-turbo
spring.ai.openai.chat.options.temperature=0.7
spring.ai.openai.chat.options.max-tokens=800

# Poe API Configuration
poe.api.key=${POE_API_KEY:dummy-key-for-dev}
poe.api.url=https://api.poe.com/api/
poe.api.bot=chinchilla
poe.api.timeout=60
```

## Usage

The service exposes a simple REST API:

### Health Check

```
GET /api/v1/ai/health
```

### Ask a Question

```
POST /api/v1/ai/ask
Content-Type: application/json

{
  "question": "What is Spring Boot?",
  "courseId": "course-123",
  "userId": "user-456",
  "context": "Optional additional context"
}
```

Response:

```json
{
  "answer": "Spring Boot is a framework that makes it easy to create stand-alone, production-grade Spring-based applications...",
  "questionId": "550e8400-e29b-41d4-a716-446655440000",
  "timestamp": "2025-03-17T04:36:51.417034",
  "sourceReferences": "Generated by OpenAI",
  "courseId": "course-123",
  "userId": "user-456",
  "success": true,
  "errorMessage": null
}
```

## Providers

### OpenAI

Uses the Spring AI OpenAI integration to communicate with OpenAI's API.

### Poe

Uses Poe's API to generate responses. This is useful as an alternative to OpenAI.

### Mock

A simulated provider for testing or demonstration purposes.

## Building and Running

```bash
# Build
./mvnw clean package

# Run (with OpenAI)
export OPENAI_API_KEY=your_api_key
java -jar target/ai-service-0.0.1-SNAPSHOT.jar

# Run (with Poe)
export POE_API_KEY=your_api_key
java -Dai.provider=poe -jar target/ai-service-0.0.1-SNAPSHOT.jar

# Run (with Mock provider)
java -Dai.provider=mock -jar target/ai-service-0.0.1-SNAPSHOT.jar
``` 